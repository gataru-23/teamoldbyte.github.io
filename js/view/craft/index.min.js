async function pageinit(r,d){"back_forward"==performance.getEntriesByType("navigation")[0].type&&location.reload();let i=!Cookies?.get("EID")&&!Cookies?.get("FMID"),o="/membership",n="/craft/battle/",s=[],a=2,l={"Ѐ":'"bid":',"Ё":'"rnum":',"Ђ":'"categoryId":',"Ѓ":'"sentenceId":',"Є":'"memberId":',"Ѕ":'"diffLevel":',"І":'"engLength":',"Ї":'"engLevel":',"Ј":'"battleType":',"Љ":'"eng":',"Њ":'"grammarTitle":',"Ћ":'"askTag":',"Ќ":'"ask":',"Ѝ":'"source":',"Ў":'"comment":',"Џ":'"example":',"А":'"answer":',"Б":'"regDate":',"В":'"updateDate":',"Г":'"[[',"Д":']]"',"Е":"],["};function c(e){return pako.deflateRaw((e=>{let t=new Map(Object.entries(l).map(([e,t])=>[t,e]));var a=new RegExp(Array.from(t.keys()).join("|").replace(/\[/g,"\\["),"g");return e.replace(a,e=>t.get(e))})(JSON.stringify(e)))}$.cachedScript=$.cachedScript||function(e,t){return $.ajax($.extend(t||{},{dataType:"script",cache:!0,url:e}))};let p='<span style="color: #ffc107;font-weight: bold;">골드 멤버십 서비스</span>입니다.\n문장 구조와 표현을 확인할 수 있는 \n<b>다양한 테스트</b>를 통해 문장을 완전히 파악해 보세요.',b={public:[],protected:[],classnote:[]};if(0==r&&Cookies.get("FMID")){$(".record-stat .alias").text(localStorage.getItem("FM_NAME"));let n="StepBattle"+ntoa(10000001);await $.cachedScript("https://cdn.jsdelivr.net/npm/idb@7/build/umd-with-async-ittr.js"),await $.cachedScript("https://cdn.jsdelivr.net/npm/pako/dist/pako.min.js"),(await indexedDB.databases()).forEach(({name:e,version:t})=>{"findsvoc-idb"==e&&t>=a&&(a=t)}),idb.openDB("findsvoc-idb",a,{async upgrade(e,t,a,o){var s=e.createObjectStore(n,{autoIncrement:!0});if(s.createIndex("bid","bid"),s.createIndex("data","data"),s.createIndex("solve","solve"),1==t){var i,t=await o.objectStore("StepBattle").getAll();t.sort((e,t)=>e.data.rnum-t.data.rnum);for(i of t)await s.add({...i,bid:ntoa(i.bid),data:c(i.data)});e.deleteObjectStore("StepBattle")}}}).then(a=>{let o={O:0,X:0};a.transaction(n).store.openCursor().then(function e(t){t?(o[t.value.solve]++,t.continue().then(e)):($("#correctRecord").text(o.O),$("#incorrectRecord").text(o.X),$("#totalRecord").text(o.O+o.X),v(),a.close(),$.getJSON("https://static.findsvoc.com/data/craft/rank-list.json",e=>{e=e.reverse().find(e=>e.startValue<o.O).rankTitle;document.querySelector(".rank-icon").replaceChildren(createElement({el:"object",type:"image/svg+xml",data:`https://static.findsvoc.com/images/app/craft/${e}.svg`}))}))})})}else 0==r&&(s=JSON.parse(localStorage.getItem("wanderingBooks"))||[]),v();var e="TCBSC_"+ntoa(r);let t=0;var m=localStorage.getItem(e);null!=m&&JSON.parse(m).date==(new Date).toLocaleDateString()&&(t=JSON.parse(m).count),0<$("#overCount").length&&(t=parseInt($("#overCount").val()),localStorage.setItem(e,JSON.stringify({date:(new Date).toLocaleDateString(),count:t}))),(i||50<=t)&&($(document).off("click",".js-play-step"),m=i?"문법별/테마별 학습을 진행하거나<br>회원이시면 로그인을 해주세요.":"일일 최대 플레이 횟수에 도달하였습니다.<br>내일 다시 찾아와 주세요.",$(".js-play-step").addClass("disabled").parent().attr("data-bs-toggle","tooltip").attr("data-bs-html","true").attr("title",m).tooltip());let u={T:"theme",S:"subscription",G:"grammar"},g=[{classname:"rewind",mtype:"r",fas:"history",title:"리뷰 플레이"},{classname:"wrong",mtype:"w",fas:"times",title:"오답 플레이"},{classname:"save",mtype:"s",fas:"save",title:"보관 플레이"}];function f(e,b){return createElement(Array.from(e,({battleBookId:e,bbid:t,title:a,bookType:o,description:s,imagePath:i,completed:n,price:l,openType:c})=>{var r={el:"span",className:"title-text",textContent:a},d="book-cover"+(i?"":" default")+(n?" pe-none":""),p=i?{backgroundImage:`url(/resource/battlebook/cover/${i})`}:{};return"subscription"==b?{el:"div",className:"book swiper-slide row g-0",dataset:{bid:e||t,bookType:u[o],title:a,completed:n},children:[{el:"div",className:"col-auto",children:[{el:"div",className:d,children:[{el:"img",src:"https://static.findsvoc.com/images/app/workbook/bookcover/book_paper.png",style:p},n?{el:"span",className:"completed"}:{el:"span",className:"play-btn-cover js-play-book","data-mtype":"b",title:"배틀북 플레이"}]}]},{el:"div",className:"col position-relative book-info-section",children:[{el:"div",className:"my-1",children:[r]},{el:"div",className:"button-section col-12 row row-cols-3 g-0 text-center btn-group",children:Array.from(g,({classname:e,mtype:t,fas:a,title:o})=>"r"!==t||n?{el:"button",className:`js-play-book ${e}-book-btn btn`,"data-mtype":t,title:o,children:[{el:"i",className:"icon fas fa-"+a}]}:{el:"div",title:"배틀을 끝까지 완료 후 리뷰 플레이가 가능합니다.",children:[{el:"button",className:"rewind-book-btn btn w-100",disabled:!0,children:[{el:"i",className:"icon fas fa-"+a}]}]})}]}]}:{el:"div",className:"book swiper-slide js-open-overview text-center",dataset:{bid:e||t,title:a,bookType:u[o],description:s,imagePath:i||"",completed:n,price:l,openType:c},children:[{el:"div",className:d,children:[{el:"img",src:"https://static.findsvoc.com/images/app/workbook/bookcover/book_paper.png",style:p}]},{el:"div",className:"title-text-section",children:[r]}]}}))}$(".battle-book-list").one("show.bs.collapse",function(){let i=this.className.match(/subscription|theme|grammar/);if(i){i=i[0];let t=this.querySelector(".book-list-container");if(null!=t){let a=t.closest(".swiper"),s=a.matches(".subscription"),o=1;function n(e){t.querySelectorAll(".book")?.forEach(e=>e.remove()),t.appendChild(f(e,i))}$.ajax({url:`/craft/battlebook/${i}/list`,success:async t=>{t?.pageable?(b[i]=t.content,t.numberOfElements<2*w(s)&&!t.last?await $.getJSON(`/craft/battlebook/${i}/list`,{pageNum:++o},function(e){b[i]=b[i].concat(e?.content),n(b[i].splice(0,2*w(s)))}):n(b[i].splice(0,2*w(s))),matchMedia("(min-width: 992px)").matches?(s&&3<t.numberOfElements||!s&&5<t.numberOfElements)&&a.classList.add("rows-2"):s?a.classList.add("rows-"+Math.min(t.numberOfElements,3)):a.classList.add("rows-"+Math.min(Math.ceil(t.numberOfElements/3),3)),new Swiper(a,{watchSlidesProgress:!0,resistanceRatio:.1,watchOverflow:!1,grid:{fill:s?"column":"row"},pagination:{dynamicBullets:!0,dynamicMainBullets:1,el:".swiper-pagination",clickable:!0,renderBullet:function(e,t){return`<span class="${t}" data-bs-toggle="tooltip" data-bs-title="${e+1}페이지">${e+1}</span>`}},breakpoints:{320:{slidesPerView:s?1:3,slidesPerGroup:s?1:3,autoHeight:t.numberOfElements<(s?3:9),spaceBetween:s?10:20,grid:{rows:s?Math.min(Math.max(1,t.numberOfElements),3):Math.min(Math.max(1,Math.ceil(t.numberOfElements/3)),3)}},992:{slidesPerView:s?3:5,slidesPerGroup:s?3:5,autoHeight:t.numberOfElements<=(s?3:5),spaceBetween:7,grid:{rows:s?Math.min(Math.max(1,t.numberOfElements/3),2):Math.min(Math.max(1,Math.ceil(t.numberOfElements/5)),2)}}},on:{beforeInit:function(e){e.isLast=t.last,t.last||(e.pageNum=o+1)},afterInit:function(e){e.lazy.load()},slideNextTransitionStart:function(o){if(!(o.isLast||o.isLoading||o.slides.length-o.visibleSlidesIndexes.slice(-1)[0]-1>=w(s))){o.isLoading=!0;let t=w(s)-(o.slides.length-o.visibleSlidesIndexes.slice(-1)[0]-1)%w(s),a=b[i]?.splice(0,2*t)??[];o.loadOver?(o.appendSlide(f(a,i)),o.isLast=0==b[i].length):a.length<t?(o.appendSlide(f(a,i)),$.getJSON(`/craft/battlebook/${i}/list`,{pageNum:o.pageNum++},function(e){delete o.isLoading,$(o.el).find(".default-message").remove(),b[i]=(b[i]??[]).concat(e.content),o.appendSlide(f(b[i].splice(0,t-a.length),i)),o.update(),e.first&&o.lazy.load(),e.last&&(o.loadOver=!0)}).fail(()=>alert("워크북목록 가져오기에 실패했습니다.\n다시 접속해 주세요."))):(delete o.isLoading,o.appendSlide(f(a,i)),o.update())}}}}),this.setAttribute("initialized",!0),t&&t?.content?.length):(alertModal("올바른 데이터를 받지 못했습니다.\n화면을 새로고침 해주세요."),a.classList.add("d-none"))},error:e=>{a.classList.add("d-none"),401==e.status?alertModal("접속시간이 초과되었습니다.\n로그인 화면으로 이동합니다.",()=>location.assign("/auth/login?destPage=/craft/main")):403==e.status?(alertModal(p),a.classList.add("d-none")):alertModal("배틀북 조회에 실패했습니다.\n화면 새로고침 후 다시 시도해 주세요.")}})}}}),r&&["A","S","M"].includes(d)&&"true"==sessionStorage.getItem("subscriptionBattleOpened")&&$(".battle-book-list.subscription").collapse("show");let h={T:"클래스용",P:"회원/비회원",M:"회원용"};function k(e){let t=e.match(/(?:craft\/battle\/\w+\/\w\/)(\w+)/)[1];var a;s.includes(t)?location.assign(e):(a=document.getElementById("askMembershipModal")||document.body.appendChild(createElement({el:"div",id:"askMembershipModal","data-bs-backdrop":"static","data-bs-return":"0",class:"modal fade",tabIndex:0,children:[{el:"div",class:"modal-dialog modal-md modal-dialog-centered",children:[{el:"div",class:"modal-content",children:[{el:"div",class:"modal-header bg-fc-purple py-1 px-3",children:[{el:"h5",class:"modal-title",textContent:"이용 안내"},{el:"button",class:"btn fas fa-times text-light p-0","data-bs-dismiss":"modal","aria-label":"Close"}]},{el:"div",class:"modal-body row g-0",children:[{el:"div",class:"text-section mb-3 text-center text-dark",innerHTML:"<span class='app-name-text'>fico</span> 멤버십 <b class='text-fc-red'>가입</b>시 테스트 <b>진행기록</b>과 <b>전적 정보</b>가 <b>저장</b>되어 다음에도 배틀을 <b>이어서 이용</b>할 수 있습니다."},{el:"div",className:"col text-center",children:[{el:"button",class:"btn btn-fico w-100 h-100",innerHTML:"<b>예</b>",onclick:()=>{location.assign(o+"?destPage="+e)}}]},{el:"div",className:"col text-center",children:[{el:"button",class:"btn btn-outline-fico w-100",innerHTML:"<b>아니오</b><br><span class='fs-7'>(가입없이 진행)</span>",onclick:()=>{s.push(t),localStorage.setItem("wanderingBooks",JSON.stringify(s)),location.assign(e)}}]}]}]}]}]})),$(a).modal("show"))}function v(){let t=(parseInt($("#correctRecord").text())/parseInt($("#totalRecord").text())*100||0).toFixed(1),a=$(".winning-rate-cover .bar"),o=$(".winning-rate-cover .needle"),s=$(".winning-rate-cover .rate-text"),i=$(".personal-info-block .rate-text-section"),n={now:0};anime({targets:n,now:100,easing:"easeOutQuad",delay:500,update:e=>{a.css("transform",`rotate(${45+1.8*n.now*t/100}deg)`),o.add(i).css("transform",`rotate(${1.8*n.now*t/100-90}deg)`),s.text((n.now*t/100).toFixed(1))}})}function w(e){return matchMedia("(min-width: 992px)").matches?e?6:10:e?3:9}$(document).on("click",".js-open-overview",function(){let a=$(this).closest(".swiper").find(".battlebook-overview-section"),{bid:e,title:o,description:s,imagePath:i,price:n,openType:l,completed:c}=this.dataset;a.data("targetBook")==this?a.is(".show")?(a.collapse("hide"),a.data("targetBook",null)):a.collapse("show"):(a.data("targetBook",this),$.getJSON("/craft/battlebook/overview/"+ntoa(e),e=>{(t=this.closest(".battle-book-list").className.match(/subscription|theme|grammar/))&&t[0];a.css("top",this.offsetTop+this.offsetHeight),a.find(".overview-tail").css("left",this.offsetLeft+.5*this.offsetWidth),a.is(".show")?a[0].scrollIntoView({behavior:"smooth",block:"nearest"}):a.collapse("show"),a.find(".book-title").text(o);var t=a.find(".book-cover");0<i?.length?t.removeClass("default").find("img").css("background-image",`url(/resource/battlebook/cover/${i})`):t.addClass("default").find("img").css("background-image",""),a.find(".description").html(s),a.find(".book-open-type").text(h[l]).attr("data-open",l),a.find(".book-price").text(n.toLocaleString()),a.find(".sub-btn").toggleClass("bg-secondary",0==r&&"P"!=l||0==r&&"true"==c||0!=r&&!!e||!e&&"U"==d).prop("disabled",0==r&&"P"!=l||0==r&&"true"==c||0!=r&&!!e||!e&&"U"==d).html(0==r?l?"true"==c?"플레이 완료":'<i class="fas fa-play me-3"></i>바로 플레이':"회원 전용":e?"구독중":"U"==d?"구독 불가 (멤버십 만료)":"구독")}).fail(()=>alertModal("배틀북 정보 가져오기에 실패했습니다.\n다시 접속해 주세요.")))}),$(".battlebook-overview-section, .battle-book-list").on("shown.bs.collapse",function(e){"subscription"==this.className.match(/subscription|theme|grammar/)&&sessionStorage.setItem("subscriptionBattleOpened","true"),e.stopPropagation(),this.scrollIntoView({behavior:"smooth",block:"nearest"})}).on("hide.bs.collapse",function(){"subscription"==this.className.match(/subscription|theme|grammar/)&&sessionStorage.setItem("subscriptionBattleOpened","false")}),$(".battlebook-overview-section").on("click",".sub-btn",function(){let{bid:e,title:t,openType:a,bookType:o,completed:s}=$(this).closest(".battlebook-overview-section").data("targetBook").dataset;if(!r)return"P"==a?Cookies.get("FMID")?void location.assign(n+o+`/b/${ntoa(parseInt(e))}?title=${encodeURIComponent(t)}&bookType=${o}&completed=${s}&wanderer=`+i):void k(n+o+`/b/${ntoa(parseInt(e))}?title=${encodeURIComponent(t)}&bookType=${o}&completed=${s}&wanderer=`+i):void(confirmModal("fico 멤버십이 필요합니다.\n로그인 화면으로 이동하시겠습니까?")&&location.assign("/auth/login"));$.post("/craft/battlebook/subscription/"+e,e=>{switch(e){case"success":alertModal(`"${t}"을(를) 구독하였습니다.
개인별 학습에서 구독한 배틀북을 확인할 수 있습니다.
녹색 플레이 버튼을 눌러 배틀을 풀어보세요`,()=>{$(this).prop("disabled",!0).text("구독중"),$(".battle-book-list.subscription").attr("initialized")?$.getJSON("/craft/battlebook/subscription/list",e=>{$(".my-book-type.subscription .book-list-container").empty().append(f(e?.content,"subscription")).collapse("show")}):$(".battle-book-list.subscription").collapse("show")});break;case"duplicated":alertModal("이미 구독한 배틀북입니다.\n'개인별 학습'을 참고해 주세요.");break;case"insufficient":alertModal("잔여 fico 코인이 부족합니다.")}}).fail(e=>{403===e.status?alertModal(p):alertModal("배틀북 구독에 실패했습니다. 화면 새로고침 후 다시 시도해 주세요.")})}),$(document).on("click",".js-play-step",function(){i?location.assign(o):!r&&Cookies?.get("EID")?location.assign("/auth/login?destPage=/craft/main"):location.assign(n+"step/b?title=단계별 학습&bookType=step&wanderer="+i)}).on("click",".js-play-book",function(){var{bid:e,title:t,bookType:a,completed:o}=this.closest(".book").dataset,s=this.dataset.mtype,e="step"===a?"":"/"+ntoa(e),o=void 0===o?"":"&completed="+o;i?k(n+a+`/${s}${e}?title=${encodeURIComponent(t)}&bookType=${a}${o}&wanderer=`+i):location.assign(n+a+`/${s}${e}?title=${encodeURIComponent(t)}&bookType=${a}${o}&wanderer=`+i)})}